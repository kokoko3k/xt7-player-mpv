' Gambas class file

'Copyright (C) 2007, 2008 Antonio Orefice
' Gambas class file

Public Sub Start()
  Dim p_profile As String = ""
  Dim helpmsg As String
  Stop
  
  global.init()
  helpmsg &= "\n" & File.Name(Application.Args[0]) & " "
  helpmsg &= "[options] file"
  
  Args.begin(helpmsg)
    Try global.arg_profile = Args.get("p", "profile", ("Start with the specified profile"), "profilename")
    Try global.arg_append = Args.Has("a", "append", ("Append the file to the playlist of a running instance"))
    Try global.arg_file = Args.end()[0]
  
  If p_profile <> "" Then 
    Debug "Will switch profile to: " & p_profile
    global.arg_profile
  Endif
  If global.arg_append Then 
    Debug "Will append instead of play"
    Try Sock_Append(global.arg_profile)
  Endif
  If global.arg_file <> "" Then
    Debug "The file to open is " & global.arg_file
  Endif
  
  Try Global.Center(Fmain, Me)
  FMain.maininit()

End




Public Sub Form_Open()
  'Start()
End

Public MyCSock As Socket

Public Sub Sock_Append(URI As String)
  Dim sBuf As String
  MyCSock = New Socket
  MyCSock.path = global.SocketFile
  MyCSock.Port = Net.Local
  MyCSock.Connect()
  While (MyCSock.Status <> 7) And (MyCSock.Status > 0)
    Wait 0.1
  Wend
  If MyCSock.Status = 7 Then
    sBuf = "append " & URI & "\n"
    Write #MyCSock, sBuf, Len(sBuf)
    Close #MycSock
  Endif
End

Public Sub Sock_Play(URI As String)
  Dim sBuf As String
  MyCSock = New Socket
  MyCSock.path = global.SocketFile
  MyCSock.Port = Net.Local
  MyCSock.Connect()
  While (MyCSock.Status <> 7) And (MyCSock.Status > 0)
    Wait 0.1
  Wend
  If MyCSock.Status = 7 Then
    sBuf = "play " & URI & "\n"
    Write #MyCSock, sBuf, Len(sBuf)
    Close #MycSock
  Endif
End

Public Sub VSplit1_Resize()
  If Not FMain.mplayer.getP("audioonly") Then
    FMain.CorrectAreaAspect()
    fmain.TimerHideShowVideo.start
  Endif
End

Public Sub LabelPanel_MouseDown()
  PanelNowNext.hide
End

Public Sub NowPanel_MouseDown()
  'PanelNowNext.hide
  ShowHidePinfo()
End

Public Sub NextPanel_MouseDown()
  'PanelNowNext.hide
  ShowHidePinfo()
End

Public Sub buttonepg_MouseDown()
  global.Center(fmain, epgform)
  EpgForm.Show()
  PanelNowNext.hide
  epgform.ScrollToChannel(Replace(fmain.mplayer.getP("fullpath"), "dvb://", ""))
End




Public Sub ShowHidePinfo()
  LabelNowInfo.visible = Not LabelNowInfo.visible  
  LabelNextInfo.visible = Not LabelNextInfo.visible
  Fmain.PanelNowNextArrange(LabelNextInfo.visible)
End
